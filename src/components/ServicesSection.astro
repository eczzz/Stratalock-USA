---
import Button from './Button.astro';
import ServiceCard from './ServiceCard.astro';

const services = [
  {
    title: 'Residential Solutions',
    description: 'Foundation repair, concrete lifting, and soil stabilization for homes experiencing settlement or structural issues.',
    iconType: 'residential' as const,
    imageSrc: '/images/residential-services-home.webp',
    imageAlt: 'Residential foundation repair service',
    reverse: false
  },
  {
    title: 'Commercial & Industrial',
    description: 'Building stabilization, floor leveling, and soil improvement with minimal disruption to daily operations.',
    iconType: 'commercial' as const,
    imageSrc: '/images/commercial-services-home-1.webp',
    imageAlt: 'Commercial building stabilization service',
    reverse: true
  },
  {
    title: 'Infrastructure & Transportation',
    description: 'Sub-base stabilization & underground infrastructure repair inflow & infiltration mediation.',
    iconType: 'infrastructure' as const,
    imageSrc: '/images/transportation-services-home-v2.webp',
    imageAlt: 'Infrastructure and transportation repair service',
    reverse: false
  }
];
---

<section class="services">
  <div class="services__container">
    <!-- Section Header -->
    <div class="services__header">
      <div class="services__header-left scroll-animate">
        <div class="services__tagline">
          <span class="services__tagline-icon"></span>
          <span class="services__tagline-text">OUR SERVICES</span>
        </div>
        <Button text="View Services" size="small" href="/services" />
      </div>

      <div class="services__header-right scroll-animate scroll-animate--delay-1">
        <h2 class="services__headline">
          Comprehensive solutions for <span class="services__headline--highlight">residential, commercial, and infrastructure</span> projects.
        </h2>
      </div>
    </div>

    <!-- Service Cards -->
    <div class="services__cards scroll-animate scroll-animate--delay-2">
      {services.map((service) => (
        <ServiceCard
          title={service.title}
          description={service.description}
          iconType={service.iconType}
          imageSrc={service.imageSrc}
          imageAlt={service.imageAlt}
          reverse={service.reverse}
        />
      ))}
    </div>
  </div>
</section>

<style>
  .services {
    background: var(--color-bg-dark-1);
    padding: 100px 0;
  }

  .services__container {
    max-width: 1512px;
    margin: 0 auto;
    padding: 0 120px;
  }

  /* Header */
  .services__header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 60px;
    margin-bottom: 80px;
  }

  .services__header-left {
    display: flex;
    flex-direction: column;
    gap: 24px;
  }

  .services__tagline {
    display: flex;
    align-items: center;
    gap: 6px;
    cursor: default;
  }

  .services__tagline-icon {
    width: 11px;
    height: 11px;
    background: var(--color-orange-primary);
    flex-shrink: 0;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .services__tagline:hover .services__tagline-icon {
    transform: rotate(45deg) scale(1.2);
    box-shadow: 0 0 15px rgba(250, 117, 35, 0.5);
  }

  .services__tagline-text {
    font-family: var(--font-manrope);
    font-size: 16px;
    font-weight: 400;
    text-transform: uppercase;
    color: var(--color-white);
    letter-spacing: 0.5px;
    transition: letter-spacing 0.3s ease;
  }

  .services__tagline:hover .services__tagline-text {
    letter-spacing: 2px;
  }

  .services__header-right {
    flex: 1;
    max-width: 727px;
  }

  .services__headline {
    font-family: var(--font-manrope);
    font-size: 48px;
    font-weight: 400;
    line-height: 120%;
    color: var(--color-gray-medium);
    margin: 0;
  }

  .services__headline--highlight {
    color: var(--color-white);
    position: relative;
    display: inline;
    background-image: linear-gradient(90deg, var(--color-orange-primary), var(--color-orange-light));
    background-size: 0% 3px;
    background-position: 0 100%;
    background-repeat: no-repeat;
    transition: color 0.3s ease, background-size 0.4s ease;
  }

  .services__headline--highlight:hover {
    color: var(--color-orange-light);
    background-size: 100% 3px;
  }

  /* Service Cards */
  .services__cards {
    display: flex;
    flex-direction: column;
    gap: 0;
    position: relative;
  }

  .services__cards > :nth-child(1) {
    margin-bottom: -100px;
  }

  .services__cards > :nth-child(2) {
    margin-left: 120px;
    margin-bottom: -100px;
  }

  .services__cards > :nth-child(3) {
    margin-left: 240px;
  }

  /* Responsive */
  @media (max-width: 1400px) {
    .services__container {
      padding: 0 60px;
    }
  }

  @media (max-width: 1024px) {
    .services__container {
      padding: 0 40px;
    }

    .services__header {
      flex-direction: column;
      gap: 40px;
      margin-bottom: 60px;
    }

    .services__headline {
      font-size: 36px;
    }

    .services__cards {
      gap: 40px;
    }

    .services__cards > :nth-child(1),
    .services__cards > :nth-child(2),
    .services__cards > :nth-child(3) {
      margin-left: 0;
      margin-bottom: 0;
    }
  }

  @media (max-width: 768px) {
    .services {
      padding: 60px 0;
      overflow-x: hidden;
    }

    .services__container {
      padding: 0 20px;
      overflow-x: hidden;
    }

    .services__headline {
      font-size: 28px;
    }

    .services__cards {
      gap: 30px;
      overflow-x: hidden;
    }
  }

  /* Scroll Animations */
  .scroll-animate {
    opacity: 0;
    transform: translateY(40px);
    transition: opacity 0.8s ease-out, transform 0.8s ease-out;
  }

  .scroll-animate--delay-1 {
    transition-delay: 0.15s;
  }

  .scroll-animate--delay-2 {
    transition-delay: 0.3s;
  }

  .scroll-animate.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  /* Faster animations on mobile to prevent scroll blocking */
  @media (max-width: 768px) {
    .scroll-animate {
      transform: translateY(20px);
      transition: opacity 0.3s ease-out, transform 0.3s ease-out;
    }

    .scroll-animate--delay-1,
    .scroll-animate--delay-2 {
      transition-delay: 0s;
    }
  }

  /* Respect reduced motion preferences */
  @media (prefers-reduced-motion: reduce) {
    .scroll-animate {
      opacity: 1;
      transform: none;
      transition: none;
    }

    .services__tagline-icon,
    .services__tagline-text,
    .services__headline--highlight {
      transition: none;
    }
  }
</style>

<script is:inline>
  (function() {
    function initServicesAnimations() {
      var observerOptions = {
        root: null,
        rootMargin: '0px 0px -50px 0px',
        threshold: 0.1
      };

      var observer = new IntersectionObserver(function(entries) {
        entries.forEach(function(entry) {
          if (entry.isIntersecting) {
            entry.target.classList.add('is-visible');
            observer.unobserve(entry.target);
          }
        });
      }, observerOptions);

      var elements = document.querySelectorAll('.services .scroll-animate');
      if (elements.length > 0) {
        elements.forEach(function(el) {
          observer.observe(el);
        });
      }
    }

    // Run on DOMContentLoaded or immediately if already loaded
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initServicesAnimations);
    } else {
      // DOM already loaded, wait for next frame to ensure CSS is applied
      requestAnimationFrame(function() {
        requestAnimationFrame(initServicesAnimations);
      });
    }
  })();
</script>
