---
// Why Choose Us Section Component

type IconKey = 'eyedropper' | 'gauge' | 'usergear';

const features: { icon: IconKey; title: string; description: string }[] = [
  {
    icon: 'eyedropper',
    title: 'Deep Soil Injection Technology',
    description: 'Our expanding polymer method addresses foundation issues at the sourceâ€”stabilizing weak soil rather than bypassing it with piers.'
  },
  {
    icon: 'gauge',
    title: 'Minimal Disruption to Operations',
    description: 'Non-invasive process allows residential and commercial projects to continue with minimal downtime and zero excavation.'
  },
  {
    icon: 'usergear',
    title: 'Specialized Engineering Expertise',
    description: 'Our team brings decades of geotechnical knowledge to solve complex soil and structural challenges other contractors can\'t address.'
  }
];

// Icon SVG paths and viewBoxes
const icons: Record<IconKey, { path: string; viewBox: string }> = {
  eyedropper: {
    path: 'M21.3497 1.81953L15.0059 8.16953L14.4184 7.58203C13.6372 6.80078 12.3684 6.80078 11.5872 7.58203C10.8059 8.36328 10.8059 9.63203 11.5872 10.4133L21.5872 20.4133C22.3684 21.1945 23.6372 21.1945 24.4184 20.4133C25.1997 19.632 25.1997 18.3633 24.4184 17.582L23.8309 16.9945L30.1747 10.6445C32.6122 8.20703 32.6122 4.25703 30.1747 1.82578C27.7372 -0.605468 23.7872 -0.611718 21.3559 1.82578L21.3497 1.81953ZM3.46218 20.2008C2.52468 21.1383 1.99968 22.4133 1.99968 23.7383V26.3883L0.33718 28.882C-0.19407 29.6758 -0.08782 30.732 0.58718 31.407C1.26218 32.082 2.31843 32.1883 3.11218 31.657L5.60593 29.9945H8.25593C9.58093 29.9945 10.8559 29.4695 11.7934 28.532L19.3372 20.9883L16.5059 18.157L8.96218 25.7008C8.77468 25.8883 8.51843 25.9945 8.25593 25.9945H5.99968V23.7383C5.99968 23.4758 6.10593 23.2195 6.29343 23.032L13.8372 15.4883L11.0059 12.657L3.46218 20.2008Z',
    viewBox: '0 0 32 32'
  },
  gauge: {
    path: 'M8 4a.5.5 0 0 1 .5.5V6a.5.5 0 0 1-1 0V4.5A.5.5 0 0 1 8 4zM3.732 5.732a.5.5 0 0 1 .707 0l.915.914a.5.5 0 1 1-.708.708l-.914-.915a.5.5 0 0 1 0-.707zM2 10a.5.5 0 0 1 .5-.5h1.586a.5.5 0 0 1 0 1H2.5A.5.5 0 0 1 2 10zm9.5 0a.5.5 0 0 1 .5-.5h1.5a.5.5 0 0 1 0 1H12a.5.5 0 0 1-.5-.5zm.754-4.246a.389.389 0 0 0-.527-.02L7.547 9.31a.91.91 0 1 0 1.302 1.258l3.434-4.297a.389.389 0 0 0-.029-.518z M0 10a8 8 0 1 1 16 0 8 8 0 0 1-16 0zm8-7a7 7 0 0 0-7 7h14a7 7 0 0 0-7-7z',
    viewBox: '0 0 16 16'
  },
  usergear: {
    path: 'M11 5a3 3 0 1 1-6 0 3 3 0 0 1 6 0zM8 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm.256 7a4.474 4.474 0 0 1-.229-1.004H3c.001-.246.154-.986.832-1.664C4.484 10.68 5.711 10 8 10c.26 0 .507.009.74.025.226-.341.496-.65.804-.918C9.077 9.038 8.564 9 8 9c-5 0-6 3-6 4s1 1 1 1h5.256zm3.63-4.54c.18-.613 1.048-.613 1.229 0l.043.148a.64.64 0 0 0 .921.382l.136-.074c.561-.306 1.175.308.87.869l-.075.136a.64.64 0 0 0 .382.92l.149.045c.612.18.612 1.048 0 1.229l-.15.043a.64.64 0 0 0-.38.921l.074.136c.305.561-.309 1.175-.87.87l-.136-.075a.64.64 0 0 0-.92.382l-.045.149c-.18.612-1.048.612-1.229 0l-.043-.15a.64.64 0 0 0-.921-.38l-.136.074c-.561.305-1.175-.309-.87-.87l.075-.136a.64.64 0 0 0-.382-.92l-.148-.045c-.613-.18-.613-1.048 0-1.229l.148-.043a.64.64 0 0 0 .382-.921l-.074-.136c-.306-.561.308-1.175.869-.87l.136.075a.64.64 0 0 0 .92-.382l.045-.148zM14 12.5a1.5 1.5 0 1 0-3 0 1.5 1.5 0 0 0 3 0z',
    viewBox: '0 0 16 16'
  }
};
---

<section class="why-choose-us">
  <div class="why-choose-us__container">
    <!-- Header -->
    <div class="why-choose-us__header">
      <div class="why-choose-us__header-left scroll-animate">
        <div class="why-choose-us__tagline">
          <span class="why-choose-us__tagline-icon"></span>
          <span class="why-choose-us__tagline-text">WHY CHOOSE US</span>
        </div>

        <h2 class="why-choose-us__headline">
          We combine <span class="why-choose-us__headline--highlight">geotechnical expertise</span> and <span class="why-choose-us__headline--highlight">proven technology</span> to deliver <span class="why-choose-us__headline--highlight">lasting solutions.</span>
        </h2>
      </div>

      <div class="why-choose-us__header-right scroll-animate scroll-animate--delay-1">
        <div class="why-choose-us__stat">
          <div class="why-choose-us__stat-number">
            40<span class="why-choose-us__stat-accent">+</span>
          </div>
          <div class="why-choose-us__stat-label">Years Combined Experience</div>
        </div>

        <div class="why-choose-us__divider"></div>

        <div class="why-choose-us__stat">
          <div class="why-choose-us__stat-number">
            98<span class="why-choose-us__stat-accent">%</span>
          </div>
          <div class="why-choose-us__stat-label">Project Success Rate</div>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="why-choose-us__content">
      <!-- Left Column: Feature Cards -->
      <div class="why-choose-us__features scroll-animate scroll-animate--delay-2">
        <div class="why-choose-us__features-fade"></div>

        <div class="why-choose-us__image-glow-container">
          <div class="why-choose-us__image-glow why-choose-us__image-glow--orange"></div>
          <div class="why-choose-us__image-glow why-choose-us__image-glow--yellow"></div>
        </div>

        {features.map((feature) => (
          <div class="why-choose-us__feature">
            <div class="why-choose-us__feature-icon-box">
              <svg class="why-choose-us__feature-icon" viewBox={icons[feature.icon].viewBox} fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d={icons[feature.icon].path} fill="#F14B00"/>
              </svg>
            </div>

            <div class="why-choose-us__feature-content">
              <h3 class="why-choose-us__feature-title">{feature.title}</h3>
              <p class="why-choose-us__feature-description">{feature.description}</p>
            </div>
          </div>
        ))}
      </div>

      <!-- Right Column: Image -->
      <div class="why-choose-us__image-container scroll-animate scroll-animate--delay-3">
        <img
          src="/images/why-choose-us-home.webp"
          alt="Stratalock worker performing deep soil injection"
          class="why-choose-us__image"
        />
      </div>
    </div>
  </div>
</section>

<style>
  .why-choose-us {
    background: var(--color-bg-dark-1);
    padding: 100px 0;
  }

  .why-choose-us__container {
    max-width: 1520px;
    margin: 0 auto;
    padding: 0 100px;
  }

  /* Header */
  .why-choose-us__header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 60px;
    margin-bottom: 60px;
  }

  .why-choose-us__header-left {
    display: flex;
    flex-direction: column;
    gap: 24px;
    max-width: 734px;
  }

  .why-choose-us__tagline {
    display: flex;
    align-items: center;
    gap: 6px;
    cursor: default;
  }

  .why-choose-us__tagline-icon {
    width: 11px;
    height: 11px;
    background: var(--color-orange-primary);
    flex-shrink: 0;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .why-choose-us__tagline:hover .why-choose-us__tagline-icon {
    transform: rotate(45deg) scale(1.2);
    box-shadow: 0 0 15px rgba(250, 117, 35, 0.5);
  }

  .why-choose-us__tagline-text {
    font-family: var(--font-manrope);
    font-size: 16px;
    font-weight: 400;
    text-transform: uppercase;
    color: var(--color-white);
    letter-spacing: 0.5px;
    transition: letter-spacing 0.3s ease;
  }

  .why-choose-us__tagline:hover .why-choose-us__tagline-text {
    letter-spacing: 2px;
  }

  .why-choose-us__headline {
    font-family: var(--font-manrope);
    font-size: 48px;
    font-weight: 400;
    line-height: 120%;
    color: #7C7C7C;
    margin: 0;
    width: 734px;
  }

  .why-choose-us__headline--highlight {
    color: var(--color-white);
    position: relative;
    display: inline;
    background-image: linear-gradient(90deg, var(--color-orange-primary), var(--color-orange-light));
    background-size: 0% 3px;
    background-position: 0 100%;
    background-repeat: no-repeat;
    transition: color 0.3s ease, background-size 0.4s ease;
  }

  .why-choose-us__headline--highlight:hover {
    color: var(--color-orange-light);
    background-size: 100% 3px;
  }

  .why-choose-us__header-right {
    display: flex;
    align-items: center;
    gap: 70px;
  }

  .why-choose-us__stat {
    display: flex;
    flex-direction: column;
    gap: 8px;
    cursor: default;
    transition: transform 0.3s ease;
  }

  .why-choose-us__stat:hover {
    transform: translateY(-4px);
  }

  .why-choose-us__stat-number {
    font-family: var(--font-manrope);
    font-size: 36px;
    font-weight: 400;
    line-height: 49px;
    color: var(--color-white);
    transition: text-shadow 0.3s ease;
  }

  .why-choose-us__stat:hover .why-choose-us__stat-number {
    text-shadow: 0 0 20px rgba(250, 117, 35, 0.3);
  }

  .why-choose-us__stat-accent {
    color: var(--color-orange-primary);
    transition: color 0.3s ease;
  }

  .why-choose-us__stat:hover .why-choose-us__stat-accent {
    color: var(--color-orange-light);
  }

  .why-choose-us__stat-label {
    font-family: var(--font-poppins);
    font-size: 16px;
    font-weight: 400;
    line-height: 24px;
    color: #A2A2A2;
    width: 134px;
    transition: color 0.3s ease;
  }

  .why-choose-us__stat:hover .why-choose-us__stat-label {
    color: var(--color-white);
  }

  .why-choose-us__divider {
    width: 1px;
    height: 29px;
    background: #525252;
    transition: height 0.3s ease, background 0.3s ease;
  }

  .why-choose-us__header-right:hover .why-choose-us__divider {
    height: 40px;
    background: var(--color-orange-primary);
  }

  /* Main Content */
  .why-choose-us__content {
    display: flex;
    gap: 24px;
  }

  /* Features Column */
  .why-choose-us__features {
    position: relative;
    flex: 1;
    min-width: 700px;
    background: #111111;
    border: 1px solid #525252;
    padding: 70px;
    display: flex;
    flex-direction: column;
    gap: 70px;
    height: 633px;
    overflow: hidden;
    transition: border-color 0.4s ease, box-shadow 0.4s ease;
  }

  .why-choose-us__features:hover {
    border-color: rgba(241, 75, 0, 0.3);
    box-shadow: inset 0 0 40px rgba(241, 75, 0, 0.03);
  }

  .why-choose-us__features-fade {
    position: absolute;
    top: 0;
    right: 0;
    width: 345px;
    height: 100%;
    background: linear-gradient(90deg, rgba(17, 17, 17, 0) 0%, rgba(17, 17, 17, 0.6) 50%, #111111 100%);
    pointer-events: none;
  }

  .why-choose-us__feature {
    display: flex;
    gap: 47px;
    align-items: flex-start;
    position: relative;
    z-index: 1;
    cursor: default;
    transition: transform 0.3s ease;
  }

  .why-choose-us__feature:hover {
    transform: translateX(8px);
  }

  /* Staggered layout - top and bottom items shifted right */
  /* Note: nth-child counts all siblings, so features are at positions 3, 4, 5 */
  .why-choose-us__feature:nth-child(3),
  .why-choose-us__feature:nth-child(5) {
    margin-left: 80px;
  }

  /* Middle item stays at original position (left) */
  .why-choose-us__feature:nth-child(4) {
    margin-left: 0;
  }

  .why-choose-us__feature-icon-box {
    width: 60px;
    height: 60px;
    background: #161616;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 4px;
    flex-shrink: 0;
    transition: transform 0.3s ease, background 0.3s ease, box-shadow 0.3s ease;
  }

  .why-choose-us__feature:hover .why-choose-us__feature-icon-box {
    transform: scale(1.1);
    background: #1a1a1a;
    box-shadow: 0 0 20px rgba(241, 75, 0, 0.3);
  }

  .why-choose-us__feature-icon {
    width: 32px;
    height: 32px;
    transition: transform 0.3s ease;
  }

  .why-choose-us__feature-icon path {
    transition: fill 0.3s ease;
  }

  .why-choose-us__feature:hover .why-choose-us__feature-icon {
    transform: scale(1.1);
  }

  .why-choose-us__feature:hover .why-choose-us__feature-icon path {
    fill: var(--color-orange-light);
  }

  .why-choose-us__feature-content {
    display: flex;
    flex-direction: column;
    gap: 24px;
    max-width: 406px;
  }

  .why-choose-us__feature-title {
    font-family: var(--font-manrope);
    font-size: 24px;
    font-weight: 400;
    line-height: 120%;
    color: var(--color-white);
    margin: 0;
    white-space: nowrap;
    transition: text-shadow 0.3s ease;
  }

  .why-choose-us__feature:hover .why-choose-us__feature-title {
    text-shadow: 0 0 30px rgba(255, 255, 255, 0.15);
  }

  .why-choose-us__feature-description {
    font-family: var(--font-poppins);
    font-size: 16px;
    font-weight: 400;
    line-height: 24px;
    color: #7C7C7C;
    margin: 0;
    transition: color 0.3s ease;
  }

  .why-choose-us__feature:hover .why-choose-us__feature-description {
    color: #A2A2A2;
  }

  /* Image Column */
  .why-choose-us__image-container {
    position: relative;
    width: 518px;
    height: 633px;
    flex-shrink: 0;
    overflow: hidden;
  }

  .why-choose-us__image-container::after {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, rgba(250, 117, 35, 0) 0%, rgba(250, 117, 35, 0.1) 100%);
    opacity: 0;
    transition: opacity 0.4s ease;
    pointer-events: none;
    z-index: 3;
  }

  .why-choose-us__image-container:hover::after {
    opacity: 1;
  }

  .why-choose-us__image-glow-container {
    position: absolute;
    right: -40px;
    top: 50%;
    transform: translateY(-50%);
    width: 100px;
    height: 400px;
    pointer-events: none;
    z-index: 1;
    transition: transform 0.5s ease;
  }

  .why-choose-us__features:hover .why-choose-us__image-glow-container {
    transform: translateY(-50%) scale(1.2);
  }

  .why-choose-us__image-glow {
    position: absolute;
    border-radius: 50%;
    transition: opacity 0.5s ease, filter 0.5s ease;
  }

  .why-choose-us__image-glow--orange {
    width: 100px;
    height: 400px;
    background: var(--color-orange-accent);
    filter: blur(80px);
    opacity: 0.4;
  }

  .why-choose-us__features:hover .why-choose-us__image-glow--orange {
    opacity: 0.6;
    filter: blur(60px);
  }

  .why-choose-us__image-glow--yellow {
    width: 60px;
    height: 300px;
    background: var(--color-orange-yellow);
    filter: blur(40px);
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    opacity: 0.5;
  }

  .why-choose-us__features:hover .why-choose-us__image-glow--yellow {
    filter: blur(30px);
  }

  .why-choose-us__image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    position: relative;
    z-index: 2;
    transition: transform 0.5s ease;
  }

  .why-choose-us__image-container:hover .why-choose-us__image {
    transform: scale(1.05);
  }

  /* Responsive */
  @media (max-width: 1600px) {
    .why-choose-us__container {
      padding: 0 80px;
    }
  }

  @media (max-width: 1400px) {
    .why-choose-us__container {
      padding: 0 60px;
    }

    .why-choose-us__header-right {
      gap: 40px;
    }
  }

  @media (max-width: 1300px) {
    .why-choose-us__header {
      gap: 40px;
    }

    .why-choose-us__headline {
      width: 100%;
      max-width: 600px;
      font-size: 40px;
    }

    .why-choose-us__header-right {
      gap: 40px;
      flex-shrink: 0;
    }

    .why-choose-us__stat-number {
      font-size: 30px;
    }

    .why-choose-us__stat-label {
      font-size: 14px;
      max-width: 120px;
    }
  }

  @media (max-width: 1200px) {
    .why-choose-us__header {
      flex-direction: column;
      align-items: flex-start;
      gap: 30px;
    }

    .why-choose-us__headline {
      max-width: 100%;
    }

    .why-choose-us__header-right {
      width: 100%;
      justify-content: flex-start;
    }

    .why-choose-us__content {
      flex-direction: column;
    }

    .why-choose-us__features {
      min-width: 0;
      width: 100%;
      height: auto;
      padding: 50px 40px;
      gap: 50px;
    }

    .why-choose-us__features-fade {
      display: none;
    }

    .why-choose-us__feature:nth-child(3),
    .why-choose-us__feature:nth-child(5) {
      margin-left: 40px;
    }

    .why-choose-us__image-container {
      width: 100%;
      height: 500px;
    }

    .why-choose-us__image-glow-container {
      right: 50%;
      top: -50px;
      transform: translateX(50%);
    }
  }

  @media (max-width: 1024px) {
    .why-choose-us__container {
      padding: 0 40px;
    }

    .why-choose-us__header {
      margin-bottom: 40px;
    }

    .why-choose-us__headline {
      font-size: 36px;
    }

    .why-choose-us__feature:nth-child(3),
    .why-choose-us__feature:nth-child(5) {
      margin-left: 20px;
    }
  }

  @media (max-width: 768px) {
    .why-choose-us {
      padding: 60px 0;
      overflow-x: hidden;
    }

    .why-choose-us__container {
      padding: 0 20px;
      overflow-x: hidden;
    }

    .why-choose-us__header {
      text-align: center;
      align-items: center;
    }

    .why-choose-us__header-left {
      align-items: center;
      max-width: 100%;
    }

    .why-choose-us__tagline {
      justify-content: center;
    }

    .why-choose-us__headline {
      font-size: 28px;
      width: 100%;
      max-width: 100%;
      text-align: center;
    }

    .why-choose-us__header-right {
      flex-direction: row;
      gap: 20px;
      width: 100%;
      align-items: center;
      justify-content: center;
    }

    .why-choose-us__stat {
      text-align: center;
      align-items: center;
      flex: 0 0 auto;
    }

    .why-choose-us__stat-number {
      font-size: 28px;
    }

    .why-choose-us__divider {
      display: block;
      height: 40px;
      width: 1px;
    }

    .why-choose-us__stat-label {
      max-width: 120px;
      width: auto;
      font-size: 14px;
      line-height: 18px;
    }

    .why-choose-us__features {
      min-width: 0;
      width: 100%;
      padding: 30px 20px;
      gap: 30px;
      height: auto;
      overflow-x: hidden;
    }

    .why-choose-us__feature {
      flex-direction: column;
      gap: 20px;
      align-items: center;
      text-align: center;
      margin-left: 0 !important;
    }

    .why-choose-us__feature-icon-box {
      width: 50px;
      height: 50px;
    }

    .why-choose-us__feature-icon {
      width: 26px;
      height: 26px;
    }

    .why-choose-us__feature-content {
      max-width: 100%;
      align-items: center;
    }

    .why-choose-us__feature-title {
      font-size: 20px;
      white-space: normal;
      text-align: center;
    }

    .why-choose-us__feature-description {
      font-size: 15px;
      line-height: 22px;
      text-align: center;
    }

    .why-choose-us__image-container {
      height: 350px;
      width: 100%;
      overflow: hidden;
    }

    .why-choose-us__image {
      object-position: center;
    }
  }

  /* Scroll Animations */
  .scroll-animate {
    opacity: 0;
    transform: translateY(40px);
    transition: opacity 0.8s ease-out, transform 0.8s ease-out;
  }

  .scroll-animate--delay-1 {
    transition-delay: 0.15s;
  }

  .scroll-animate--delay-2 {
    transition-delay: 0.3s;
  }

  .scroll-animate--delay-3 {
    transition-delay: 0.45s;
  }

  .scroll-animate.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  /* Respect reduced motion preferences */
  @media (prefers-reduced-motion: reduce) {
    .scroll-animate {
      opacity: 1;
      transform: none;
      transition: none;
    }

    .why-choose-us__tagline-icon,
    .why-choose-us__tagline-text,
    .why-choose-us__headline--highlight,
    .why-choose-us__stat,
    .why-choose-us__stat-number,
    .why-choose-us__stat-accent,
    .why-choose-us__stat-label,
    .why-choose-us__divider,
    .why-choose-us__features,
    .why-choose-us__feature,
    .why-choose-us__feature-icon-box,
    .why-choose-us__feature-icon,
    .why-choose-us__feature-icon path,
    .why-choose-us__feature-title,
    .why-choose-us__feature-description,
    .why-choose-us__image-container::after,
    .why-choose-us__image-glow-container,
    .why-choose-us__image-glow,
    .why-choose-us__image {
      transition: none;
    }
  }
</style>

<script is:inline>
  (function() {
    function initWhyChooseUsAnimations() {
      var elements = document.querySelectorAll('.why-choose-us .scroll-animate');
      if (elements.length === 0) return;

      // Check if element is in viewport
      function isInViewport(el) {
        var rect = el.getBoundingClientRect();
        return (
          rect.top < (window.innerHeight || document.documentElement.clientHeight) &&
          rect.bottom > 0
        );
      }

      var observerOptions = {
        root: null,
        rootMargin: '0px 0px -50px 0px',
        threshold: 0.1
      };

      var observer = new IntersectionObserver(function(entries) {
        entries.forEach(function(entry) {
          if (entry.isIntersecting) {
            entry.target.classList.add('is-visible');
            observer.unobserve(entry.target);
          }
        });
      }, observerOptions);

      elements.forEach(function(el) {
        // If already in viewport, add visible class immediately
        if (isInViewport(el)) {
          el.classList.add('is-visible');
        } else {
          observer.observe(el);
        }
      });
    }

    function runInit() {
      requestAnimationFrame(function() {
        requestAnimationFrame(initWhyChooseUsAnimations);
      });
    }

    // Run on DOMContentLoaded
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', runInit);
    } else {
      runInit();
    }

    // Also run on Astro page load (for view transitions)
    document.addEventListener('astro:page-load', runInit);
  })();
</script>
